<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>拖拽排列卡片组件 | 菜头丸首页</title>
    <meta name="description" content="菜头丸的前端学习记录">
    <link rel="icon" href="/blog/logo.png">
    
    <link rel="preload" href="/blog/assets/css/0.styles.230da05a.css" as="style"><link rel="preload" href="/blog/assets/js/app.514fd556.js" as="script"><link rel="preload" href="/blog/assets/js/2.cb37ac30.js" as="script"><link rel="preload" href="/blog/assets/js/13.5df811c0.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.48cd7db3.js"><link rel="prefetch" href="/blog/assets/js/11.fa78767a.js"><link rel="prefetch" href="/blog/assets/js/12.855b0ca8.js"><link rel="prefetch" href="/blog/assets/js/14.036afc4a.js"><link rel="prefetch" href="/blog/assets/js/3.dfd3e300.js"><link rel="prefetch" href="/blog/assets/js/4.3cbb97e6.js"><link rel="prefetch" href="/blog/assets/js/5.addc3232.js"><link rel="prefetch" href="/blog/assets/js/6.036f6f97.js"><link rel="prefetch" href="/blog/assets/js/7.2eb0416b.js"><link rel="prefetch" href="/blog/assets/js/8.4f03b8a0.js"><link rel="prefetch" href="/blog/assets/js/9.33f96147.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.230da05a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="菜头丸首页" class="logo"> <span class="site-name can-hide">菜头丸首页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/articles/1024.html" class="nav-link">小游戏</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/vue/dragCard.html" class="nav-link router-link-exact-active router-link-active">Vue</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/react/city.html" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dranein" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分类" class="dropdown-title"><span class="title">分类</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/pages/articles/1024.html" class="nav-link">小游戏</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/vue/dragCard.html" class="nav-link router-link-exact-active router-link-active">Vue</a></li><li class="dropdown-item"><!----> <a href="/blog/pages/react/city.html" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/dranein" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/pages/vue/dragCard.html" class="active sidebar-link">拖拽排列卡片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/pages/vue/dragCard.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/pages/vue/dragCard.html#使用" class="sidebar-link">使用</a></li><li class="sidebar-sub-header"><a href="/blog/pages/vue/dragCard.html#具体实现" class="sidebar-link">具体实现</a></li><li class="sidebar-sub-header"><a href="/blog/pages/vue/dragCard.html#写在后面" class="sidebar-link">写在后面</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="拖拽排列卡片组件"><a href="#拖拽排列卡片组件" class="header-anchor">#</a> 拖拽排列卡片组件</h1> <p><img src="https://github.com/Dranein/dranein.github.io/blob/master/blog/dragCard.gif?raw=true" alt="预览图"></p> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>之前在掘金上看到了一遍分享拖拽卡片组件的文章，看了大致思路，觉得很清晰，也想动手实现一下；</p> <p>在过程中发现了蛮多的细节问题，完成后对比了原作者的代码，发现许多可以优化的地方，在这里记录一下；</p> <p>以下是个人学习实现的demo和源码地址：</p> <ul><li><a href="https://dranein.github.io/components/dragCard/" target="_blank" rel="noopener noreferrer">在线链接<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Dranein/vue-study/tree/master/dragCard/src" target="_blank" rel="noopener noreferrer">源码地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <p>在仓库中拿到dragCard.vue文件，引入到项目中，来看下面这个例子</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// app.js</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>DragCard
      <span class="token punctuation">:</span>list<span class="token operator">=</span><span class="token string">&quot;list&quot;</span>
      <span class="token punctuation">:</span>col<span class="token operator">=</span><span class="token string">&quot;4&quot;</span>
      <span class="token punctuation">:</span>itemWidth<span class="token operator">=</span><span class="token string">&quot;150&quot;</span>
      <span class="token punctuation">:</span>itemHeight<span class="token operator">=</span><span class="token string">&quot;150&quot;</span>
      @change<span class="token operator">=</span><span class="token string">&quot;handleChange&quot;</span>
      @mouseUp<span class="token operator">=</span><span class="token string">&quot;handleMouseUp&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>DragCard<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> DragCard <span class="token keyword">from</span> <span class="token string">'./components/DragCard.vue'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      DragCard
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>head<span class="token punctuation">:</span> <span class="token string">'标题0'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">&quot;演示卡片0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>head<span class="token punctuation">:</span> <span class="token string">'标题1'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">&quot;演示卡片1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>head<span class="token punctuation">:</span> <span class="token string">'标题2'</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">&quot;演示卡片2&quot;</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">handleMouseUp</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="来看看props和方法"><a href="#来看看props和方法" class="header-anchor">#</a> 来看看props和方法</h3> <p>通过组件属性和方法可以快速了解整个组件的使用；</p> <h4 id="属性"><a href="#属性" class="header-anchor">#</a> 属性</h4> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">默认值</th></tr></thead> <tbody><tr><td style="text-align:left;">list</td> <td style="text-align:left;">卡片数据</td> <td style="text-align:left;">Array</td> <td style="text-align:left;">[]</td></tr> <tr><td style="text-align:left;">col</td> <td style="text-align:left;">每一行显示多少张卡片</td> <td style="text-align:left;">Number</td> <td style="text-align:left;">3</td></tr> <tr><td style="text-align:left;">itemWidth</td> <td style="text-align:left;">每个卡片的宽度（包括外边距）</td> <td style="text-align:left;">Number</td> <td style="text-align:left;">150</td></tr> <tr><td style="text-align:left;">itemHeight</td> <td style="text-align:left;">每个卡片的高度（包括外边距）</td> <td style="text-align:left;">Number</td> <td style="text-align:left;">150</td></tr></tbody></table> <h4 id="方法"><a href="#方法" class="header-anchor">#</a> 方法</h4> <table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">返回值</th></tr></thead> <tbody><tr><td style="text-align:left;">@change</td> <td style="text-align:left;">当卡片位置变动的时候触发</td> <td style="text-align:left;">返回的是数组中每一项的位置序号数组</td></tr> <tr><td style="text-align:left;">@mouseUp</td> <td style="text-align:left;">当拖拽完卡片松手的时候触发</td> <td style="text-align:left;">同上</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>返回值是数组中每一项的位置序号集合；返回值数组<code>index</code>和<code>list</code>中的<code>index</code>一致；后续我们可以通过操作这两个数组，合并成<code>[{ id: 'cardid1', seatid: '1' }...]</code>这样的形式传递给后端，修改卡片的位置数据；当然建议是在mouseUp的时候去发送请求更优；</p></div> <h4 id="插槽slot"><a href="#插槽slot" class="header-anchor">#</a> 插槽slot</h4> <table><thead><tr><th style="text-align:left;">slotName</th> <th style="text-align:left;">说明</th> <th style="text-align:left;">data</th></tr></thead> <tbody><tr><td style="text-align:left;">head</td> <td style="text-align:left;">卡片的头部标题部分</td> <td style="text-align:left;">listItem</td></tr> <tr><td style="text-align:left;">content</td> <td style="text-align:left;">卡片内容部分</td> <td style="text-align:left;">listItem</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这两个作用域插槽都有默认值，如果不填写的话，标题将显示<code>list</code>中的<code>head</code>属性，而内容将显示<code>content</code>属性；两个<code>slot</code>都带上了当前卡片的<code>list</code>项数据；可以更加灵活的自定义卡片内容；</p></div> <h2 id="具体实现"><a href="#具体实现" class="header-anchor">#</a> 具体实现</h2> <h3 id="大概思路"><a href="#大概思路" class="header-anchor">#</a> 大概思路</h3> <ul><li>页面卡片采用<code>absolute</code>布局，通过设置<code>left</code>和<code>top</code>，让卡片按顺序排列，因此传入的<code>list</code>必须是正序的；</li> <li>初始化样式，通过<code>props</code>传入的值，我们可以计算出行列数，卡片位置等信息；</li> <li>给数组中的每一项添加一个位置标识属性，后续的位置交换都可以通过这个标识标识来展开，也是后面触发方法给父级传递的返回值；</li> <li>当鼠标按下的时候，记录下鼠标的当前位置作为起始位置，，当前卡片作为参数传入，并绑定<code>mousemove</code>和<code>mouseup</code>事件；这时候鼠标的移动距离就是卡片的移动距离；</li> <li>在卡片移动的时候，我们计算出当前是否移动到其他的卡片位置，是的话，相隔之间的所有卡片向后移或向前移，触发父组件的<code>change</code>方法；</li> <li>当鼠标松开的时候，卡片回到目标位置,触发父组件的<code>mouseUp</code>方法；</li></ul> <h3 id="首先看下页面结构"><a href="#首先看下页面结构" class="header-anchor">#</a> 首先看下页面结构</h3> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code>  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div
      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_warpper&quot;</span>
      ref<span class="token operator">=</span><span class="token string">&quot;dragCard_warpper&quot;</span>
      <span class="token punctuation">:</span>style<span class="token operator">=</span><span class="token string">&quot;dragCardWarpperStyle&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div
        v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;(item, index) in list&quot;</span>
        <span class="token punctuation">:</span>key<span class="token operator">=</span><span class="token string">&quot;index&quot;</span>
        <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_item&quot;</span>
        <span class="token punctuation">:</span>style<span class="token operator">=</span><span class="token string">&quot;initItemStyle(index)&quot;</span>
        <span class="token punctuation">:</span>ref<span class="token operator">=</span><span class="token string">&quot;item.dragCard_id&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_content&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>div
            <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_head&quot;</span>
            @mousedown<span class="token operator">=</span><span class="token string">&quot;touchStart($event, item)&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">&quot;head&quot;</span> <span class="token punctuation">:</span>item<span class="token operator">=</span><span class="token string">&quot;item&quot;</span> <span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_head-defaut&quot;</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>head <span class="token operator">?</span> item<span class="token punctuation">.</span>head <span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">卡片标题</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_body&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">&quot;content&quot;</span> <span class="token punctuation">:</span>item<span class="token operator">=</span><span class="token string">&quot;item&quot;</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragCard_body-defaut&quot;</span><span class="token operator">&gt;</span>
                <span class="token punctuation">{</span><span class="token punctuation">{</span> item<span class="token punctuation">.</span>content <span class="token operator">?</span> item<span class="token punctuation">.</span>content <span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">暂无数据</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>鼠标点击标题可以拖动卡片，所以<code>@mousedown</code>设置在<code>dragCard_head</code>中，为了实现这一点，把<code>slot</code>分为了两个部分，一个是<code>head</code>标题部分，默认显示<code>item.content</code>；一个是<code>content</code>内容部分，默认显示<code>item.head</code>，；用户可以通过<code>slot</code>自定义卡片；<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD" target="_blank" rel="noopener noreferrer">slot知识点<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token comment">// app.js  使用自定义卡片样式</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>DragCard
      <span class="token punctuation">:</span>list<span class="token operator">=</span><span class="token string">&quot;list&quot;</span>
      <span class="token punctuation">:</span>col<span class="token operator">=</span><span class="token string">&quot;4&quot;</span>
      <span class="token punctuation">:</span>itemWidth<span class="token operator">=</span><span class="token string">&quot;150&quot;</span>
      <span class="token punctuation">:</span>itemHeight<span class="token operator">=</span><span class="token string">&quot;150&quot;</span>
      @change<span class="token operator">=</span><span class="token string">&quot;handleChange&quot;</span>
      @mouseUp<span class="token operator">=</span><span class="token string">&quot;handleMouseUp&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>head<span class="token operator">=</span><span class="token string">&quot;{ item }&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragHead&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>head<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token punctuation">:</span>content<span class="token operator">=</span><span class="token string">&quot;{ item }&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dragContent&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>content<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>DragCard<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>dragCardWarpperStyle为容器的样式，通过props传入的值计算出容器的宽高；在组件初始化的时候就应该去计算了，用init()包含起来；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ... </span>
 <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token function">init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 根据数组的长度length和每行个数col，可以计算出需要多少行row，超出不满一行算一行，用ceil向上取整；</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>row <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 计算出容器的宽高</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>dragCardWarpperStyle <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">width: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>col <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemWidth<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px; height:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>row <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
     <span class="token comment">/*
     * 这里处理下数组，引入两个重要的属性：
     * dragCard_id：
     *   给每一个卡片创建一个唯一id，作为ref值，后续通过this.$refs[dragCard_id]获取卡片的dom
     * dragCard_index：
     *   这是每个卡片的位置序号，用于记录卡片当前位置
     * */</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">'dragCard_index'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">'dragCard_id'</span><span class="token punctuation">,</span> <span class="token string">'dragCard_id'</span> <span class="token operator">+</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token comment">// 通过index计算出每个卡片的left和right</span>
   <span class="token function">initItemStyle</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">INDEX</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemWidth <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
        left<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token constant">INDEX</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>col <span class="token operator">?</span> <span class="token constant">INDEX</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token constant">INDEX</span> <span class="token operator">%</span> <span class="token keyword">this</span><span class="token punctuation">.</span>col<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemWidth <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">,</span>
        top<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token constant">INDEX</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>col<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>itemHeight <span class="token operator">+</span> <span class="token string">'px'</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li>当然我们的卡片数据是从父级传入的，所以<code>list</code>肯定会有改变的场景，这时候我们就要重新计算行列数，重新计算容器宽高等，其实也就是重新执行<code>init</code>函数；所以我们需要监听<code>list</code>；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    list<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">handler</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      immediate<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 定义的时候就执行一次，所以created的时候就不需要执行init了</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="handlemousedown"><a href="#handlemousedown" class="header-anchor">#</a> handleMousedown()</h3> <p>在<code>handleMousedown()</code>的时候直接定义<code>handleMousemove()</code>和<code>handleMouseUp()</code>事件，并且在<code>handleMouseUp()</code>中移除；</p> <p>首先是几个比较重要的变量和方法</p> <ul><li><p><code>itemList</code> ：<code>list</code>的拷贝，并加上后续需要用到的属性<code>dom</code>（当前卡片的节点信息，通过ref获取）, <code>isMoveing</code>（标记当前卡片是否在移动中）, <code>left</code>, <code>top</code>,</p></li> <li><p><code>curItem</code> ：当前卡片用的比较多，所以这里单独拿了出来，并且在移动的时候，单前卡片的过渡效果应该去除，不然移动会卡顿，并且<code>z-index</code>应该在较高的层级</p></li> <li><p><code>targetItem</code> ： 即将交换位置的卡片对象，起始为<code>null</code></p></li> <li><p><code>mousePosition</code> ：鼠标起始位置，移动后的鼠标位置减去起始位置，就是卡片的移动偏移量；</p></li> <li><p><code>handleMousemove()</code> ：鼠标移动</p></li> <li><p><code>cardDetect()</code> ：卡片移动检测，是否需要执行位置交换</p></li> <li><p><code>swicthPosition()</code> ：交换卡片位置</p></li> <li><p><code>handleMouseUp()</code> ：鼠标抬起</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">handleMousedown</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> optionItem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// timer为全局的定时器，表示当前有卡片正在移动，直接返回；</span>
  
  <span class="token comment">// 拷贝一份list，并加上后续要使用的属性；</span>
  <span class="token keyword">let</span> itemList <span class="token operator">=</span> that<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果ref是动态赋的值，存入$refs中会是一个数组；</span>
    <span class="token keyword">let</span> dom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">[</span>item<span class="token punctuation">.</span>dragCard_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> top <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> isMoveing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 标记正在移动的卡片，正在移动的卡片不参与碰撞检测</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">,</span> dom<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> isMoveing<span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 当前卡片对象用的比较多，用一个别名curItem把他存起来；</span>
  <span class="token keyword">let</span> curItem <span class="token operator">=</span> itemList<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>dragCard_id <span class="token operator">===</span> optionItem<span class="token punctuation">.</span>dragCard_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
  curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>zIndex <span class="token operator">=</span> <span class="token string">'100'</span><span class="token punctuation">;</span>
  curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>boxShadow <span class="token operator">=</span> <span class="token string">'0 0 5px rgba(0, 0, 0, 0.1)'</span><span class="token punctuation">;</span>
  curItem<span class="token punctuation">.</span>startLeft <span class="token operator">=</span> curItem<span class="token punctuation">.</span>left<span class="token punctuation">;</span> <span class="token comment">// 起始的left</span>
  curItem<span class="token punctuation">.</span>startTop <span class="token operator">=</span> curItem<span class="token punctuation">.</span>top<span class="token punctuation">;</span> <span class="token comment">// 起始的top</span>
  curItem<span class="token punctuation">.</span>OffsetLeft <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// left的偏移量</span>
  curItem<span class="token punctuation">.</span>OffsetTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// top的偏移量</span>

  <span class="token comment">// 即将交换位置的对象</span>
  <span class="token keyword">let</span> targetItem <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// 记录鼠标起始位置</span>
  <span class="token keyword">let</span> mousePosition <span class="token operator">=</span> <span class="token punctuation">{</span>
    startX<span class="token punctuation">:</span> e<span class="token punctuation">.</span>screenX<span class="token punctuation">,</span>
    startY<span class="token punctuation">:</span> e<span class="token punctuation">.</span>screenY
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> handleMousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mouseup&quot;</span><span class="token punctuation">,</span> handleMouseUp<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// 鼠标移动</span>
  <span class="token keyword">function</span> <span class="token function">handleMousemove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 卡片交换检测</span>
  <span class="token keyword">function</span> <span class="token function">cardDetect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 卡片交换 </span>
  <span class="token keyword">function</span> <span class="token function">swicthPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// 鼠标抬起</span>
  <span class="token keyword">function</span> <span class="token function">handleMouseUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="handlemousemove-e"><a href="#handlemousemove-e" class="header-anchor">#</a> handleMousemove(e)</h3> <p>鼠标当前的坐标减去起始的坐标，就是当前卡片的偏移量；</p> <p>移动过程中就可以执行卡片交换检测，为了提高性能，做了以下节流；200ms执行一次；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 鼠标移动</span>
  <span class="token keyword">function</span> <span class="token function">handleMousemove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    curItem<span class="token punctuation">.</span>OffsetLeft <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>screenX <span class="token operator">-</span> mousePosition<span class="token punctuation">.</span>startX<span class="token punctuation">)</span><span class="token punctuation">;</span>
    curItem<span class="token punctuation">.</span>OffsetTop <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>screenY <span class="token operator">-</span> mousePosition<span class="token punctuation">.</span>startY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 改变当前卡片对应的style</span>
    curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> curItem<span class="token punctuation">.</span>startLeft <span class="token operator">+</span> curItem<span class="token punctuation">.</span>OffsetLeft <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> curItem<span class="token punctuation">.</span>startTop <span class="token operator">+</span> curItem<span class="token punctuation">.</span>OffsetTop <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    <span class="token comment">// 卡片交换检测，做一下节流</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>DectetTimer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      DectetTimer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">cardDetect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>DectetTimer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        DectetTimer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="carddetect"><a href="#carddetect" class="header-anchor">#</a> cardDetect()</h3> <p>一开始想到的是用碰撞检测去做，循环整个itemList，然后对比当前卡片和每一项的距离；当小于设定的<code>gap</code>的时候，就执行<code>swicthPosition()</code>；</p> <p>后面看了<code>裂泉</code>的原文章后，发现之前的做法性能差太多了；一直在循环数组；</p> <p>通过当前的位置和偏移量，可以计算出目标位置<code>targetItemDragCardIndex</code>,判断一些临界值之后便执行交换函数；</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 卡片移动检测</span>
  <span class="token keyword">function</span> <span class="token function">cardDetect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据移动的距离计算出移动到哪一个位置</span>
    <span class="token keyword">let</span> colNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>curItem<span class="token punctuation">.</span>OffsetLeft <span class="token operator">/</span> that<span class="token punctuation">.</span>itemWidth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> rowNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>curItem<span class="token punctuation">.</span>OffsetTop <span class="token operator">/</span> that<span class="token punctuation">.</span>itemHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里的dragCard_index需要用到最初点击卡片的位置，因为curItem在后续的卡片交换中dragCard_index已经改变；</span>
    <span class="token keyword">let</span> targetItemDragCardIndex <span class="token operator">=</span> optionItem<span class="token punctuation">.</span>dragCard_index <span class="token operator">+</span> colNum <span class="token operator">+</span> <span class="token punctuation">(</span>rowNum <span class="token operator">*</span> that<span class="token punctuation">.</span>col<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 超出行列，目标位置不变或不存在都直接return；</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> that<span class="token punctuation">.</span>col
      <span class="token operator">||</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> that<span class="token punctuation">.</span>row
      <span class="token operator">||</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>colNum<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> that<span class="token punctuation">.</span>col
      <span class="token operator">||</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>rowNum<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> that<span class="token punctuation">.</span>row
      <span class="token operator">||</span> targetItemDragCardIndex <span class="token operator">===</span> curItem<span class="token punctuation">.</span>dragCard_index
      <span class="token operator">||</span> targetItemDragCardIndex <span class="token operator">&lt;</span> <span class="token number">0</span>
      <span class="token operator">||</span> targetItemDragCardIndex <span class="token operator">&gt;</span> that<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> item <span class="token operator">=</span> itemList<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>dragCard_index <span class="token operator">===</span> targetItemDragCardIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    item<span class="token punctuation">.</span>isMoveing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// 将目标卡片拷贝一份，主要是为了松开鼠标的时候赋值给当前卡片；</span>
    targetItem <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>item<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">swicthPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="swicthposition"><a href="#swicthposition" class="header-anchor">#</a> swicthPosition()</h3> <p>卡片交换分为两种情况；</p> <ul><li>当目标位置比当前移动卡片的原位置大的时候，相隔的卡片和目标卡片都要后移一个位置；</li> <li>当目标位置比当前移动卡片的原位置小的时候，相隔的卡片和目标卡片都要前移一个位置；</li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <ol><li>当我们移动的时候，我们拿的是前一个或者后一个的值，所以我们遍历数组的时候要注意从目标值开始遍历；</li> <li>itemList是list的备份，当我们修改了卡片的dragCard_index之后，需要同步到list中；</li> <li>卡片交换动画为300ms，这个时间段卡片不应该参与交换检测，所以设置<code>isMoveing = true</code>,并设置定时器300ms后清除<code>isMoveing</code></li> <li>交换卡片过程中，当前卡片只需要改变<code>itemList</code>中的属性，不需要改变<code>list</code>中，等到最后松开鼠标的时候才同步到<code>list</code>中</li></ol></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">swicthPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dragCardIndexList <span class="token operator">=</span> itemList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 目标卡片位置大于当前卡片位置；</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetItem<span class="token punctuation">.</span>dragCard_index <span class="token operator">&gt;</span> curItem<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> targetItem<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> curItem<span class="token punctuation">.</span>dragCard_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> item <span class="token operator">=</span> itemList<span class="token punctuation">[</span>dragCardIndexList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> preItem <span class="token operator">=</span> itemList<span class="token punctuation">[</span>dragCardIndexList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>isMoveing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>left <span class="token operator">=</span> preItem<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>top <span class="token operator">=</span> preItem<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> item<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> item<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>dragCard_index <span class="token operator">=</span> that<span class="token punctuation">.</span>list<span class="token punctuation">[</span>dragCardIndexList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dragCard_index <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span>isMoveing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 目标卡片位置小于当前卡片位置；</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetItem<span class="token punctuation">.</span>dragCard_index <span class="token operator">&lt;</span> curItem<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> targetItem<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> curItem<span class="token punctuation">.</span>dragCard_index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> item <span class="token operator">=</span> itemList<span class="token punctuation">[</span>dragCardIndexList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> nextItem <span class="token operator">=</span> itemList<span class="token punctuation">[</span>dragCardIndexList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>isMoveing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>left <span class="token operator">=</span> nextItem<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>top <span class="token operator">=</span> nextItem<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> item<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> item<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
        item<span class="token punctuation">.</span>dragCard_index <span class="token operator">=</span> that<span class="token punctuation">.</span>list<span class="token punctuation">[</span>dragCardIndexList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dragCard_index <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span>isMoveing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    curItem<span class="token punctuation">.</span>left <span class="token operator">=</span> targetItem<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    curItem<span class="token punctuation">.</span>top <span class="token operator">=</span> targetItem<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
    curItem<span class="token punctuation">.</span>dragCard_index <span class="token operator">=</span>  targetItem<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">;</span>
    <span class="token comment">// 派发change事件通知父组件</span>
    that<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> itemList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="handlemouseup"><a href="#handlemouseup" class="header-anchor">#</a> handleMouseUp()</h3> <ul><li>当鼠标抬起的时候应该判断是否有目标卡片，如果有的话，就回到目标卡片，没有的话就回到初始位置；</li> <li>当前卡片在鼠标点击的时候去除了过渡效果，当鼠标抬起的时候应该给过渡效果加回去；因为<code>transition</code>在<code>css</code>中设置了,这里把<code>style</code>清除即可</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">handleMouseUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//移除所有监听</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> handleMousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mouseup&quot;</span><span class="token punctuation">,</span> handleMouseUp<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 清除检测的定时器并做最后一次碰撞检测</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>DectetTimer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    DectetTimer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token function">cardDetect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 把过渡效果加回去</span>
    curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token comment">// 同步dragCard_index到list中；</span>
    that<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>dragCard_id <span class="token operator">===</span> optionItem<span class="token punctuation">.</span>dragCard_id<span class="token punctuation">)</span><span class="token punctuation">.</span>dragCard_index <span class="token operator">=</span> curItem<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">;</span>
    curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> curItem<span class="token punctuation">.</span>left <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
    curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> curItem<span class="token punctuation">.</span>top <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>    
    <span class="token comment">// 派发mouseUp事件通知父组件</span>
    that<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'mouseUp'</span><span class="token punctuation">,</span> that<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>dragCard_index<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    that<span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>zIndex <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
      curItem<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>boxShadow <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      that<span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="写在后面"><a href="#写在后面" class="header-anchor">#</a> 写在后面</h2> <p>到这里这个组件就完成啦!</p> <p>最后贴上来自<code>裂泉</code>的原文章链接:  <a href="https://juejin.im/post/5dae5daae51d4524c24821de" target="_blank" rel="noopener noreferrer">跟我一起，从0实现并封装拖拽排列组件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ；这还是一个系列文章，<code>todo</code>中后续还会分享如果把组件上传到<code>npm</code>;</p> <p>dranein@163.com</p> <p>地址：https://github.com/Dranein/vue-study/tree/master/dragCard/src</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">12/31/2019, 6:01:18 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.514fd556.js" defer></script><script src="/blog/assets/js/2.cb37ac30.js" defer></script><script src="/blog/assets/js/13.5df811c0.js" defer></script>
  </body>
</html>
